(this["webpackJsonpcalling-fm"]=this["webpackJsonpcalling-fm"]||[]).push([[0],{1036:function(e,n,t){var i={"./fm.liveswitch":247,"./fm.liveswitch.d.ts":1037,"./fm.liveswitch.js":247,"./package":391,"./package.json":391};function o(e){var n=a(e);return t(n)}function a(e){if(!t.o(i,e)){var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}return i[e]}o.keys=function(){return Object.keys(i)},o.resolve=a,e.exports=o,o.id=1036},1043:function(e,n,t){"use strict";t.r(n);var i=t(0),o=t.n(i),a=t(22),s=t.n(a),r=(t(413),t(129)),c=t(131),u=t(393),d=t(394),l=t(406),h=t(404),g=t(181),m=t(29),p=function(e){var n=e.onJoin,t=o.a.useState(""),i=Object(g.a)(t,2),a=i[0],s=i[1],r=o.a.useState(""),c=Object(g.a)(r,2),u=c[0],d=c[1],l=o.a.useState(""),h=Object(g.a)(l,2),p=h[0],f=h[1];return o.a.createElement("div",null,o.a.createElement("div",null,"Channel Id:",o.a.createElement(m.Input,{type:"text",value:a,onChange:s})),o.a.createElement("div",null,"User Id:",o.a.createElement(m.Input,{type:"text",value:u,onChange:d})),o.a.createElement("div",null,"Device Id:",o.a.createElement(m.Input,{type:"text",value:p,onChange:f})),o.a.createElement("div",null,o.a.createElement(m.Button,{content:"JOIN",onClick:function(){return n({channelId:a,userId:u,deviceId:p})}})))},f=t(247),S=f.Client,v=f.Token,C=f.ChannelClaim,A=f.LocalMedia,O=f.AudioStream,M=f.VideoStream,E=f.RemoteMedia,I=f.DomLayoutManager,U="https://demo.liveswitch.fm:8443/sync",V=function(e){Object(l.a)(t,e);var n=Object(h.a)(t);function t(){var e;Object(u.a)(this,t);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return(e=n.call.apply(n,[this].concat(o))).remoteMedias=[],e.state={isAudio:!0,isVideo:!1,isScreen:!1,peers:{}},e.toggleAudio=function(){e.setState((function(e){return{isAudio:!e.isAudio}}))},e.toggleVideo=function(){e.setState((function(e){return{isVideo:!e.isVideo}}))},e.toggleScreen=function(){e.setState((function(e){return{isScreen:!e.isScreen}}))},e.getActionsStatusAsString=function(){return JSON.stringify({isAudio:e.state.isAudio,isVideo:e.state.isVideo,isScreen:e.state.isScreen})},e.sendActionStatusToAll=function(){e.channel&&e.channel.sendMessage(e.getActionsStatusAsString())},e.sendAudioVideoUpConnections=function(){var n=new O(e.audioLM,null);e.upAudioConnection=e.channel.createSfuUpstreamConnection(n),e.upAudioConnection.setTag("AUDIO"),e.upAudioConnection.open();var t=new M(e.videoLM,null);e.upVideoConnection=e.channel.createSfuUpstreamConnection(t),e.upVideoConnection.setTag("VIDEO"),e.upVideoConnection.open()},e.sendUpScreenConnection=function(){var n=new M(e.screenLM,null);e.upScreenConnection=e.channel.createSfuUpstreamConnection(n),e.upScreenConnection.setTag("SCREEN"),e.upScreenConnection.open()},e.closeUpScreenConnection=function(){e.upScreenConnection.close()},e.listenToChannel=function(){e.channel.addOnRemoteUpstreamConnectionOpen((function(n){var t=n.getTag();"SCREEN"===t&&e.state.isScreen&&e.toggleScreen();var i,o=new E,a=n.getUserId();"AUDIO"===t?i=new O(null,o):(i=new M(null,o),e.remoteMedias.push({userId:a,type:t,remoteMedia:o})),"SCREEN"===t&&e.layoutManager.addRemoteView(o.getId(),o.getView()),e.channel.createSfuDownstreamConnection(n,i).open()})),e.channel.addOnRemoteUpstreamConnectionClose((function(n){var t=n.getTag(),i=n.getUserId(),o=e.remoteMedias.find((function(e){return e.userId===i&&e.type===t}));o&&(e.layoutManager.removeRemoteView(o.remoteMedia.getId()),e.remoteMedias=e.remoteMedias.filter((function(e){return e!==o})))})),e.channel.addOnUserMessage((function(n,t){var i=n.getUserId(),o=JSON.parse(t);if(e.setState((function(e){return{peers:Object(c.a)(Object(c.a)({},e.peers),{},Object(r.a)({},i,{isVideo:o.isVideo,isAudio:o.isAudio,isScreen:o.isScreen}))}})),"ACKNOWLEDGEMENT"!==o.type){var a=JSON.parse(e.getActionsStatusAsString());a.type="ACKNOWLEDGEMENT",e.channel.sendUserMessage(i,JSON.stringify(a))}})),e.channel.addOnMessage((function(n,t){var i=n.getUserId();if(i!==e.channel.getUserId()){var o=JSON.parse(t);e.setState((function(e){return{peers:Object(c.a)(Object(c.a)({},e.peers),{},Object(r.a)({},i,{isVideo:o.isVideo,isAudio:o.isAudio,isScreen:o.isScreen}))}}));var a=e.remoteMedias.find((function(e){return e.userId===i}));a&&(o.isVideo?e.layoutManager.addRemoteView(a.remoteMedia.getId(),a.remoteMedia.getView()):e.layoutManager.removeRemoteView(a.remoteMedia.getId()))}})),e.channel.addOnRemoteClientJoin((function(n){var t=n.getUserId();e.channel.sendUserMessage(t,e.getActionsStatusAsString())}))},e.handleJoin=function(n){var t=n.channelId,i=n.userId,o=n.deviceId;e.client=new S(U,"my-app-id",i,o);var a=v.generateClientRegisterToken(e.client,[new C(t)],"--replaceThisWithYourOwnSharedSecret--");e.client.register(a).then((function(n){e.channel=n[0],e.sendAudioVideoUpConnections(),e.listenToChannel()}))},e}return Object(d.a)(t,[{key:"componentDidMount",value:function(){this.audioLM=new A(!0,!1),this.audioLM.start(),this.videoLM=new A(!1,!0),this.screenLM=new A(!1,!0,!0),this.layoutManager=new I(this.layoutRef)}},{key:"componentDidUpdate",value:function(e,n){var t=this;n.isAudio!==this.state.isAudio&&(this.audioLM&&this.audioLM.getAudioTrack().setMuted(!this.state.isAudio),this.sendActionStatusToAll()),n.isVideo!==this.state.isVideo&&(this.state.isVideo?this.videoLM.start():this.videoLM.stop(),this.sendActionStatusToAll()),n.isScreen!==this.state.isScreen&&(this.state.isScreen?this.screenLM.start().then((function(){t.sendUpScreenConnection()})):this.screenLM.stop().then((function(){t.closeUpScreenConnection()})),this.sendActionStatusToAll())}},{key:"render",value:function(){var e=this;return o.a.createElement("div",null,o.a.createElement(p,{onJoin:this.handleJoin}),o.a.createElement(m.Button,{onClick:this.toggleVideo,content:"TURN VIDEO ".concat(this.state.isVideo?"OFF":"ON")})," ",o.a.createElement("br",null),o.a.createElement(m.Button,{onClick:this.toggleAudio,content:"TURN AUDIO ".concat(this.state.isAudio?"OFF":"ON")})," ",o.a.createElement("br",null),o.a.createElement(m.Button,{onClick:this.toggleScreen,content:"TURN SCREEN ".concat(this.state.isScreen?"OFF":"ON")})," ",o.a.createElement("br",null),o.a.createElement("div",null,JSON.stringify(this.state.peers)),o.a.createElement("div",{className:"layout",ref:function(n){return e.layoutRef=n}}))}}]),t}(o.a.Component);s.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(V,null)),document.getElementById("root"))},408:function(e,n,t){e.exports=t(1043)},413:function(e,n,t){},719:function(e,n){}},[[408,1,2]]]);
//# sourceMappingURL=main.61d1efd0.chunk.js.map